<section class="profile-section">
  <!-- User info -->
  <div class="profile-header">
    <img [src]="getAvatarUrl(profile().user.avatar)" alt="{{ profile().user.username }}" class="avatar-large" />
    <h2>{{ profile().user.username }}</h2>
    <div class="follow-stats">
      <!-- Follow Button -->
      <button class="follow-btn" *ngIf="profile().user.username !== currentUser()" [class.following]="isFollowing()"
        (click)="toggleFollow()">
        {{ isFollowing() ? 'Following' : 'Follow' }}
      </button>
      <!-- Report Button -->
      <button class="report-btn" *ngIf="profile().user.username !== currentUser()" (click)="openReportPopup()"
        title="Report User">
        ⚠️ Report
      </button>
    </div>
    <div class="follow-stats">
      <button (click)="toggleFollowers()">
        Followers: {{ profile().followers.length }}
      </button>
      <button (click)="toggleFollowing()">
        Following: {{ profile().following.length }}
      </button>
    </div>
  </div>

  <!-- Followers / Following -->
  <div class="followers-list" *ngIf="showFollowers">
    <h3>Followers</h3>
    <div class="users-grid">
      <div class="user-card" *ngFor="let user of profile().followers">
        <img [src]="getAvatarUrl(user.avatar)" alt="{{ user.username }}" />
        <span>{{ user.username }}</span>
      </div>
    </div>
  </div>

  <div class="following-list" *ngIf="showFollowing">
    <h3>Following</h3>
    <div class="users-grid">
      <div class="user-card" *ngFor="let user of profile().following">
        <img [src]="getAvatarUrl(user.avatar)" alt="{{ user.username }}" />
        <span>{{ user.username }}</span>
      </div>
    </div>
  </div>

  <div class="posts-grid" (scroll)="getmyposts($event)">
    @if (profile().posts().length > 0) {
    <app-post-item *ngFor="let post of profile().posts()" [post]="post" [currentUser]="currentUser()"
      (onDelete)="handleDelete($event)">
    </app-post-item>
    } @else {
    <div class="no-posts">
      <p>No posts yet.</p>
    </div>
    }
  </div>


</section>

<!-- Report User Popup -->
<div class="report-popup" *ngIf="showReportPopup()">
  <div class="popup-content">
    <h3>Report User</h3>
    <p>Reporting: <strong>@{{ profile().user.username }}</strong></p>
    <div class="reasons">
      <button *ngFor="let reason of reportReasons" (click)="submitUserReport(reason)">
        {{ reason }}
      </button>
    </div>
    <button class="close-btn" (click)="closeReportPopup()">Cancel</button>
  </div>
</div>