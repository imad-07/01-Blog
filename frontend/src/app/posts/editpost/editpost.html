<div class="edit-post-page">
  <div class="edit-post-card">
    <h2>Edit Post</h2>

    <form (ngSubmit)="onSubmit()" enctype="multipart/form-data">
      <label>Title</label>
      <input [ngModel]="title()" (ngModelChange)="title.set($event)" name="title" required placeholder="3-30 characters"
        [class.invalid]="title() !== '' && !isTitleValid()" />
      <div class="error-text" *ngIf="title() !== '' && !isTitleValid()">Title must be between 3 and 30 characters</div>

      <label>Content</label>
      <textarea [ngModel]="content()" (ngModelChange)="content.set($event)" name="content" rows="6" required
        placeholder="2-2500 characters" [class.invalid]="content() !== '' && !isContentValid()"></textarea>
      <div class="error-text" *ngIf="content() !== '' && !isContentValid()">Content must be between 2 and 2500
        characters</div>

      <label>Media (optional, max 20MB)</label>
      <input type="file" (change)="onFileSelected($event)" accept="image/*,video/*"
        [class.invalid]="!isFileSizeValid()" />
      <div class="error-text" *ngIf="!isFileSizeValid()">File size exceeds 20MB limit</div>

      <ng-container *ngIf="mediaUrl()">
        <div class="media-preview" [ngSwitch]="type">
          <div class="media-container" style="position: relative; display: inline-block;">
            <img *ngSwitchCase="'image'" [src]="mediaUrl()" alt="{{ title() }}" style="max-width: 100%;" />
            <video *ngSwitchCase="'video'" [src]="mediaUrl()" controls style="max-width: 100%;"></video>
            <button type="button" (click)="removeMedia()"
              style="position: absolute; top: 5px; right: 5px; background: red; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer;">X</button>
          </div>
        </div>
      </ng-container>

      <button type="submit" class="btn-primary" [disabled]="!isFormValid()" [class.disabled]="!isFormValid()">Save
        Changes</button>
    </form>

    <p class="back-link">
      <button (click)="onbackClick()">Back to Feed</button>
    </p>
  </div>
</div>